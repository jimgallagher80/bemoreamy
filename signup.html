<!doctype html>
<html lang="en-GB">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BE MORE AMY â€” Sign Up</title>
<link rel="stylesheet" href="style.css">

<style>
.signup-wrap { margin-top: 10px; border:2px solid #000; border-radius:18px; background:#fff; padding:16px; }
.form-grid { display:grid; gap:14px; }
.field label { display:block; font-weight:700; margin-bottom:6px; }
.field input, .field select {
    width:100%;
    padding:12px;
    border:2px solid #000;
    border-radius:14px;
    font-size:16px;
}

.legs-block { border:2px solid rgba(0,0,0,0.12); border-radius:16px; padding:12px; }
.legs-title { font-weight:800; margin-bottom:10px; }

.btn {
    width:100%;
    padding:14px;
    border-radius:16px;
    border:2px solid #000;
    background:#FAEBC8;
    font-weight:800;
    font-size:16px;
    cursor:pointer;
}
.status { margin-top:10px; padding:10px; border:2px solid #000; border-radius:14px; display:none; font-weight:700; }

.modal-backdrop {
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.6);
    display:none;
    align-items:center;
    justify-content:center;
    padding:20px;
}
.modal {
    background:#fff;
    border:2px solid #000;
    border-radius:18px;
    padding:16px;
    max-width:600px;
}
.modal button {
    margin-top:10px;
    padding:10px 14px;
    border-radius:14px;
    border:2px solid #000;
    background:#FAEBC8;
    font-weight:800;
}
.linkish { text-decoration:underline; font-weight:800; cursor:pointer; }
</style>
</head>

<body>

<header class="site-header">
  <div class="header-inner">
    <div class="menu-wrap">
      <button class="menu-button" id="menuBtn">
        <img src="menu.svg" width="22">
      </button>
      <nav class="menu-dropdown" id="site-menu">
        <a href="index.html">The Challenge</a>
        <a href="amy.html">About Amy</a>
        <a href="route.html">The Route</a>
        <a href="signup.html">Sign Up</a>
        <a href="gallery.html">Gallery</a>
        <a href="contact.html">Contact</a>
      </nav>
    </div>
    <div class="brand">
      <a href="index.html">
        <img class="brand-logo" src="BMAlogo.svg" width="100">
      </a>
      <div class="brand-text">
        <div class="brand-title">BE MORE AMY</div>
        <div>South West Coastal Path Relay Challenge</div>
        <div>16th to 25th May 2026</div>
      </div>
    </div>
  </div>
</header>

<main class="page">
<h1>Sign Up</h1>

<div class="signup-wrap">
<div id="statusBox" class="status"></div>

<form id="signupForm" class="form-grid" novalidate>

<div class="field">
<label>First Name</label>
<input id="firstName" required>
</div>

<div class="field">
<label>Last Name</label>
<input id="lastName" required>
</div>

<div class="field">
<label>Email</label>
<input id="email" type="email" required>
</div>

<div class="field">
<label>Mobile</label>
<input id="mobile" required>
</div>

<div class="field">
<label>Emergency Contact Name</label>
<input id="emergencyName" required>
</div>

<div class="field">
<label>Emergency Contact Phone</label>
<input id="emergencyPhone" required>
</div>

<div class="legs-block">
<div class="legs-title">Choose your legs</div>
<div id="legsContainer"></div>
<button type="button" id="addLegBtn" class="btn">Add Another Leg</button>
</div>

<div>
<input type="checkbox" id="safetyAccepted">
<label for="safetyAccepted">
I confirm I have read and agree to the
<span class="linkish" id="openSafety">safety information</span>.
</label>
</div>

<button type="submit" class="btn">Submit</button>

</form>
</div>
</main>

<div class="modal-backdrop" id="safetyModal">
<div class="modal">
<h2>Safety Information</h2>
<p>
Participants are responsible for their own safety, navigation, equipment and wellbeing.
By signing up you confirm you understand participation is at your own risk and that
you and any team members take full responsibility for your involvement.
Nothing excludes liability where unlawful.
</p>
<button id="closeSafety">Close</button>
</div>
</div>

<script>
const form = document.getElementById('signupForm');
const legsContainer = document.getElementById('legsContainer');
const statusBox = document.getElementById('statusBox');
const addLegBtn = document.getElementById('addLegBtn');

const TOTAL_LEGS = 50; // change to your actual number

function createLegDropdown() {
    const select = document.createElement('select');
    select.required = true;
    select.innerHTML = '<option value="">Select a leg</option>';
    for (let i = 1; i <= TOTAL_LEGS; i++) {
        select.innerHTML += `<option value="${i}">Leg ${i}</option>`;
    }
    select.style.marginBottom = "10px";
    legsContainer.appendChild(select);
}

createLegDropdown();

addLegBtn.addEventListener('click', createLegDropdown);

form.addEventListener('submit', async (e)=>{
    e.preventDefault();

    const legs = Array.from(legsContainer.querySelectorAll('select'))
        .map(s => parseInt(s.value))
        .filter(n => !isNaN(n));

    if (!legs.length) return showStatus("Please select at least one leg.");
    if (!document.getElementById('safetyAccepted').checked)
        return showStatus("You must accept the safety information.");

    const payload = {
        first_name: firstName.value.trim(),
        last_name: lastName.value.trim(),
        email: email.value.trim(),
        mobile: mobile.value.trim(),
        emergency_name: emergencyName.value.trim(),
        emergency_phone: emergencyPhone.value.trim(),
        safety_accepted: 1,
        legs: legs
    };

    const res = await fetch('/submit_signup.php', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(payload)
    });

    const out = await res.json();

    if(out.ok){
        showStatus("Signup received. Pending approval.");
        form.reset();
        legsContainer.innerHTML = '';
        createLegDropdown();
    } else {
        showStatus(out.error || "Submission failed.");
    }
});

function showStatus(msg){
    statusBox.textContent = msg;
    statusBox.style.display = "block";
}

document.getElementById('openSafety').onclick = ()=>{
    document.getElementById('safetyModal').style.display='flex';
};
document.getElementById('closeSafety').onclick = ()=>{
    document.getElementById('safetyModal').style.display='none';
};

document.getElementById("menuBtn").onclick = function(){
    document.getElementById("site-menu").classList.toggle("open");
};
</script>

</body>
</html>
