<!doctype html>
<html lang="en-GB">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BE MORE AMY — Sign Up</title>
<link rel="stylesheet" href="style.css">

<style>
/* FIX: keep inputs/selects inside their container on mobile */
*, *::before, *::after { box-sizing: border-box; }

.signup-wrap { margin-top: 10px; border:2px solid #000; border-radius:18px; background:#fff; padding:16px; overflow:hidden; }
.form-grid { display:grid; gap:14px; min-width:0; }
.field label { display:block; font-weight:700; margin-bottom:6px; }
.field { min-width:0; }
.field input, .field select {
  width:100%;
  max-width:100%;
  display:block;
  min-width:0;
  padding:12px;
  border:2px solid #000;
  border-radius:14px;
  font-size:16px;
  box-sizing: border-box; /* extra safety */
}

.legs-block { border:2px solid rgba(0,0,0,0.12); border-radius:16px; padding:12px; }
.legs-title { font-weight:800; margin-bottom:10px; }

.btn {
  width:100%;
  max-width:100%;
  padding:14px;
  border-radius:16px;
  border:2px solid #000;
  background:#FAEBC8;
  color:#111;
  font-weight:800;
  font-size:16px;
  cursor:pointer;
  box-sizing: border-box;
}

.modal-backdrop {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  padding:20px;
  z-index: 9999;
}
.modal {
  background:#fff;
  border:2px solid #000;
  border-radius:18px;
  padding:16px;
  max-width:600px;
  width:100%;
  box-sizing: border-box;
}
.modal button {
  margin-top:10px;
  padding:10px 14px;
  border-radius:14px;
  border:2px solid #000;
  background:#FAEBC8;
  color:#111;
  font-weight:800;
  width:100%;
  max-width:100%;
  box-sizing: border-box;
}

.linkish { text-decoration:underline; font-weight:800; cursor:pointer; }
.intro-text { margin-bottom:16px; line-height:1.4; }
</style>
</head>

<body>

<header class="site-header">
  <div class="header-inner">
    <div class="menu-wrap">
      <button class="menu-button" id="menuBtn">
        <img src="menu.svg" width="22" height="22" alt="Menu">
      </button>
      <nav class="menu-dropdown" id="site-menu">
        <a href="index.html">The Challenge</a>
        <a href="amy.html">About Amy</a>
        <a href="route.html">The Route</a>
        <a href="signup.html">Sign Up</a>
        <a href="signup-status.html">Signup Status</a>
        <a href="charities.html">Charities</a>
        <a href="gallery.html">Gallery</a>
        <a href="contact.html">Contact</a>
      </nav>
    </div>

    <div class="brand">
      <a href="index.html">
        <img class="brand-logo" src="BMAlogo.svg" width="100" alt="Be More Amy">
      </a>
      <div class="brand-text">
        <div class="brand-line brand-title">BE MORE AMY</div>
        <div class="brand-line brand-subtitle">South West Coastal</div>
        <div class="brand-line brand-subtitle">Path Relay Challenge</div>
        <div class="brand-line brand-date">16th to 23rd May 2026</div>
      </div>
    </div>
  </div>
</header>

<main class="page">
<h1>Sign Up</h1>

<div class="intro-text">
  <p>
    Team leaders should sign up using the form below. Once confirmed, you will receive an email with a further link to a form to collect full details of your team, including contact and emergency contact information.
  </p>
  <p>
    Before selecting a leg, please check the
    <a href="signup-status.html" class="linkish">list of confirmed signups</a>.
    If you select a leg that is already taken, your interest will be noted should that leg become available.
  </p>
</div>

<div class="signup-wrap">
<form id="signupForm" class="form-grid" novalidate>

  <div class="field">
    <label for="teamLeaderFirstName">Team Leader First Name</label>
    <input id="teamLeaderFirstName" required>
  </div>

  <div class="field">
    <label for="teamLeaderSurname">Team Leader Surname</label>
    <input id="teamLeaderSurname" required>
  </div>

  <div class="field">
    <label for="groupSize">
      Number of people in your group
      <span class="linkish" id="openGroupInfo" aria-label="More information">ⓘ</span>
    </label>
    <input id="groupSize" type="number" inputmode="numeric" min="1" max="100" required>
  </div>

  <div class="field">
    <label for="email">E-mail</label>
    <input id="email" type="email" required>
  </div>

  <div class="field">
    <label for="phone">Phone Number</label>
    <input id="phone" required>
  </div>

  <div class="legs-block">
    <div class="legs-title">Choose your legs</div>
    <div id="legsContainer"></div>
    <div id="takenNotice" style="margin:10px 0 10px; font-weight:700;"></div>
    <button type="button" id="addLegBtn" class="btn">Add Another Leg</button>
  </div>

  <div>
    <input type="checkbox" id="safetyAccepted">
    <label for="safetyAccepted">
      I confirm I have read and agree to the
      <span class="linkish" id="openSafety">safety and logistics information</span>.
    </label>
  </div>

  <button type="submit" class="btn" id="submitBtn">Submit</button>

</form>
</div>
</main>

<!-- Safety & Logistics modal -->
<div class="modal-backdrop" id="safetyModal">
  <div class="modal">
    <h2>Safety and Logistics Information</h2>

    <p>
      This is a self-led relay challenge. By signing up, you confirm that you and your team members are responsible for your own safety, planning, navigation, equipment, fitness to take part, and wellbeing throughout your leg(s). You should take appropriate precautions for coastal path conditions, weather, tides, and terrain, and you are responsible for following relevant laws and guidance, including road safety where applicable.
    </p>

    <p>
      A kit list will be sent out in advance of the event to help teams prepare appropriately.
    </p>

    <p>
      Teams should plan their own transport to and from the start and finish of their legs. While there may be transport available to assist at certain transition points, this cannot be guaranteed for every leg transition at this stage.
    </p>

    <p>
      The organisers and associated volunteers do not provide supervision, medical cover, or safety support on the route. Participation is voluntary and undertaken at your own risk.
    </p>

    <p>
      Nothing in this notice excludes or limits liability where it would be unlawful to do so.
    </p>

    <button type="button" id="closeSafety">Close</button>
  </div>
</div>

<!-- Group size info modal -->
<div class="modal-backdrop" id="groupInfoModal">
  <div class="modal">
    <h2>Group Information</h2>
    <p>Names, contact details and emergency contact details for all members of the group will be collected later.</p>
    <button type="button" id="closeGroupInfo">Close</button>
  </div>
</div>

<!-- Success modal -->
<div class="modal-backdrop" id="successModal">
  <div class="modal">
    <h2>Thank You</h2>
    <p>Your signup has been received and is now pending approval.</p>
    <p>Click continue to view the current signups.</p>
    <button type="button" id="closeSuccess">Continue</button>
  </div>
</div>

<script>
const form = document.getElementById('signupForm');
const legsContainer = document.getElementById('legsContainer');
const addLegBtn = document.getElementById('addLegBtn');

const teamLeaderFirstName = document.getElementById('teamLeaderFirstName');
const teamLeaderSurname = document.getElementById('teamLeaderSurname');
const email = document.getElementById('email');
const groupSize = document.getElementById('groupSize');
const phone = document.getElementById('phone');
const safetyAccepted = document.getElementById('safetyAccepted');

const TOTAL_LEGS = 68;
let TAKEN_LEGS = new Set();

async function loadTakenLegs() {
  try {
    const res = await fetch('get_taken_legs.php');
    const data = await res.json();
    if (data && data.success && Array.isArray(data.taken_legs)) {
      TAKEN_LEGS = new Set(data.taken_legs.map(n => String(n)));
    } else {
      TAKEN_LEGS = new Set();
    }
  } catch (e) {
    TAKEN_LEGS = new Set();
  }
}

function applyAvailabilityToSelect(selectEl) {
  Array.from(selectEl.options).forEach(opt => {
    if (!opt.value) return;
    if (!opt.dataset.baseText) opt.dataset.baseText = opt.textContent;
    const taken = TAKEN_LEGS.has(String(opt.value));
    opt.textContent = opt.dataset.baseText + (taken ? ' - Taken' : ' - Available');
  });
}

function refreshTakenNotice() {
  const notice = document.getElementById('takenNotice');
  const selected = legSelects.map(s => s.value).filter(Boolean);
  const takenSelected = selected.filter(v => TAKEN_LEGS.has(String(v)));

  if (!notice) return;

  if (takenSelected.length === 0) {
    notice.textContent = '';
    return;
  }

  const uniq = Array.from(new Set(takenSelected.map(v => String(v)))).sort((a,b)=>parseInt(a)-parseInt(b));
  notice.textContent = `Leg${uniq.length > 1 ? 's' : ''} ${uniq.join(', ')} ${uniq.length > 1 ? 'are' : 'is'} already taken. If you proceed with this selection, your interest will be noted should it become available.`;
}

// Only used to generate the dropdown labels (kept as-is)
const LEG_INFO = {
  "1":{"start":"Studland","end":"Durlston Head","setoff":"Sat 16 May 2026 08:00","finish":"Sat 16 May 2026 10:27"},
  "2":{"start":"Durlston Head","end":"Kimmeridge","setoff":"Sat 16 May 2026 10:27","finish":"Sat 16 May 2026 13:44"},
  "3":{"start":"Kimmeridge","end":"Durdle Door","setoff":"Sat 16 May 2026 13:44","finish":"Sat 16 May 2026 16:22"},
  "4":{"start":"Durdle Door","end":"Bowleaze Cove","setoff":"Sat 16 May 2026 16:22","finish":"Sat 16 May 2026 18:33"},
  "5":{"start":"Bowleaze Cove","end":"Chesil Beach","setoff":"Sat 16 May 2026 18:33","finish":"Sat 16 May 2026 20:01"},
  "6":{"start":"Chesil Beach","end":"Portland Bill","setoff":"Sat 16 May 2026 20:01","finish":"Sat 16 May 2026 21:51"},
  "7":{"start":"Portland Bill","end":"Wyke Regis","setoff":"Sat 16 May 2026 21:51","finish":"Sat 16 May 2026 23:41"},
  "8":{"start":"Wyke Regis","end":"Abbotsbury","setoff":"Sat 16 May 2026 23:41","finish":"Sun 17 May 2026 02:14"},
  "9":{"start":"Abbotsbury","end":"West Bay","setoff":"Sun 17 May 2026 02:14","finish":"Sun 17 May 2026 04:48"},
  "10":{"start":"West Bay","end":"Seatown","setoff":"Sun 17 May 2026 04:48","finish":"Sun 17 May 2026 07:00"},
  "11":{"start":"Seatown","end":"Lyme Regis","setoff":"Sun 17 May 2026 07:00","finish":"Sun 17 May 2026 09:19"},
  "12":{"start":"Lyme Regis","end":"Seaton","setoff":"Sun 17 May 2026 09:19","finish":"Sun 17 May 2026 11:53"},
  "13":{"start":"Seaton","end":"Budleigh Salterton","setoff":"Sun 17 May 2026 11:53","finish":"Sun 17 May 2026 15:03"},
  "14":{"start":"Budleigh Salterton","end":"Exmouth","setoff":"Sun 17 May 2026 15:03","finish":"Sun 17 May 2026 16:45"},
  "15":{"start":"Exmouth","end":"Dawlish","setoff":"Sun 17 May 2026 16:45","finish":"Sun 17 May 2026 19:26"},
  "16":{"start":"Dawlish","end":"Teignmouth","setoff":"Sun 17 May 2026 19:26","finish":"Sun 17 May 2026 21:20"},
  "17":{"start":"Teignmouth","end":"Shaldon","setoff":"Sun 17 May 2026 21:20","finish":"Sun 17 May 2026 22:11"},
  "18":{"start":"Shaldon","end":"Torquay","setoff":"Sun 17 May 2026 22:11","finish":"Mon 18 May 2026 01:09"},
  "19":{"start":"Torquay","end":"Brixham","setoff":"Mon 18 May 2026 01:09","finish":"Mon 18 May 2026 03:35"},
  "20":{"start":"Brixham","end":"Dartmouth","setoff":"Mon 18 May 2026 03:35","finish":"Mon 18 May 2026 06:17"},
  "21":{"start":"Dartmouth","end":"East Prawle","setoff":"Mon 18 May 2026 06:17","finish":"Mon 18 May 2026 09:34"},
  "22":{"start":"East Prawle","end":"Hope Cove","setoff":"Mon 18 May 2026 09:34","finish":"Mon 18 May 2026 11:36"},
  "23":{"start":"Hope Cove","end":"Bigbury-on-Sea","setoff":"Mon 18 May 2026 11:36","finish":"Mon 18 May 2026 13:31"},
  "24":{"start":"Bigbury-on-Sea","end":"Plymouth","setoff":"Mon 18 May 2026 13:31","finish":"Mon 18 May 2026 17:21"},
  "25":{"start":"Plymouth","end":"Cawsand","setoff":"Mon 18 May 2026 17:21","finish":"Mon 18 May 2026 19:55"},
  "26":{"start":"Cawsand","end":"Portwrinkle","setoff":"Mon 18 May 2026 19:55","finish":"Mon 18 May 2026 23:06"},
  "27":{"start":"Portwrinkle","end":"Looe","setoff":"Mon 18 May 2026 23:06","finish":"Tue 19 May 2026 02:04"},
  "28":{"start":"Looe","end":"Polruan","setoff":"Tue 19 May 2026 02:04","finish":"Tue 19 May 2026 04:43"},
  "29":{"start":"Polruan","end":"Fowey","setoff":"Tue 19 May 2026 04:43","finish":"Tue 19 May 2026 05:37"},
  "30":{"start":"Fowey","end":"Charlestown","setoff":"Tue 19 May 2026 05:37","finish":"Tue 19 May 2026 07:27"},
  "31":{"start":"Charlestown","end":"Mevagissey","setoff":"Tue 19 May 2026 07:27","finish":"Tue 19 May 2026 09:34"},
  "32":{"start":"Mevagissey","end":"Portscatho","setoff":"Tue 19 May 2026 09:34","finish":"Tue 19 May 2026 12:17"},
  "33":{"start":"Portscatho","end":"St Mawes","setoff":"Tue 19 May 2026 12:17","finish":"Tue 19 May 2026 13:54"},
  "34":{"start":"St Mawes","end":"Portloe","setoff":"Tue 19 May 2026 13:54","finish":"Tue 19 May 2026 16:17"},
  "35":{"start":"Portloe","end":"Coverack","setoff":"Tue 19 May 2026 16:17","finish":"Tue 19 May 2026 19:32"},
  "36":{"start":"Coverack","end":"Mullion Cove","setoff":"Tue 19 May 2026 19:32","finish":"Tue 19 May 2026 22:03"},
  "37":{"start":"Mullion Cove","end":"Porthleven","setoff":"Tue 19 May 2026 22:03","finish":"Wed 20 May 2026 00:18"},
  "38":{"start":"Porthleven","end":"Marazion","setoff":"Wed 20 May 2026 00:18","finish":"Wed 20 May 2026 02:54"},
  "39":{"start":"Marazion","end":"Penzance","setoff":"Wed 20 May 2026 02:54","finish":"Wed 20 May 2026 04:53"},
  "40":{"start":"Penzance","end":"Mousehole","setoff":"Wed 20 May 2026 04:53","finish":"Wed 20 May 2026 06:12"},
  "41":{"start":"Mousehole","end":"Lamorna Cove","setoff":"Wed 20 May 2026 06:12","finish":"Wed 20 May 2026 08:16"},
  "42":{"start":"Lamorna Cove","end":"St Levan","setoff":"Wed 20 May 2026 08:16","finish":"Wed 20 May 2026 10:25"},
  "43":{"start":"St Levan","end":"Sennen","setoff":"Wed 20 May 2026 10:25","finish":"Wed 20 May 2026 12:35"},
  "44":{"start":"Sennen","end":"St Ives","setoff":"Wed 20 May 2026 12:35","finish":"Wed 20 May 2026 17:11"},
  "45":{"start":"St Ives","end":"Portreath","setoff":"Wed 20 May 2026 17:11","finish":"Wed 20 May 2026 20:58"},
  "46":{"start":"Portreath","end":"Perranporth","setoff":"Wed 20 May 2026 20:58","finish":"Wed 20 May 2026 23:29"},
  "47":{"start":"Perranporth","end":"Newquay","setoff":"Wed 20 May 2026 23:29","finish":"Thu 21 May 2026 02:40"},
  "48":{"start":"Newquay","end":"Padstow","setoff":"Thu 21 May 2026 02:40","finish":"Thu 21 May 2026 06:26"},
  "49":{"start":"Padstow","end":"Port Isaac","setoff":"Thu 21 May 2026 06:26","finish":"Thu 21 May 2026 09:28"},
  "50":{"start":"Port Isaac","end":"Tintagel","setoff":"Thu 21 May 2026 09:28","finish":"Thu 21 May 2026 12:36"},
  "51":{"start":"Tintagel","end":"Bude","setoff":"Thu 21 May 2026 12:36","finish":"Thu 21 May 2026 16:25"},
  "52":{"start":"Bude","end":"Hartland Quay","setoff":"Thu 21 May 2026 16:25","finish":"Thu 21 May 2026 19:59"},
  "53":{"start":"Hartland Quay","end":"Clovelly","setoff":"Thu 21 May 2026 19:59","finish":"Thu 21 May 2026 22:28"},
  "54":{"start":"Clovelly","end":"Westward Ho!","setoff":"Thu 21 May 2026 22:28","finish":"Fri 22 May 2026 01:04"},
  "55":{"start":"Westward Ho!","end":"Braunton","setoff":"Fri 22 May 2026 01:04","finish":"Fri 22 May 2026 04:58"},
  "56":{"start":"Braunton","end":"Ilfracombe","setoff":"Fri 22 May 2026 04:58","finish":"Fri 22 May 2026 08:07"},
  "57":{"start":"Ilfracombe","end":"Lynmouth","setoff":"Fri 22 May 2026 08:07","finish":"Fri 22 May 2026 11:41"},
  "58":{"start":"Lynmouth","end":"Porlock","setoff":"Fri 22 May 2026 11:41","finish":"Fri 22 May 2026 15:41"},
  "59":{"start":"Porlock","end":"Minehead","setoff":"Fri 22 May 2026 15:41","finish":"Fri 22 May 2026 18:44"},
  "60":{"start":"Minehead","end":"Watchet","setoff":"Fri 22 May 2026 18:44","finish":"Fri 22 May 2026 21:47"},
  "61":{"start":"Watchet","end":"Kilve","setoff":"Fri 22 May 2026 21:47","finish":"Sat 23 May 2026 01:17"},
  "62":{"start":"Kilve","end":"Hinkley Point","setoff":"Sat 23 May 2026 01:17","finish":"Sat 23 May 2026 02:53"},
  "63":{"start":"Hinkley Point","end":"Burnham-on-Sea","setoff":"Sat 23 May 2026 02:53","finish":"Sat 23 May 2026 06:36"},
  "64":{"start":"Burnham-on-Sea","end":"Weston-super-Mare","setoff":"Sat 23 May 2026 06:36","finish":"Sat 23 May 2026 09:37"},
  "65":{"start":"Weston-super-Mare","end":"Clevedon","setoff":"Sat 23 May 2026 09:37","finish":"Sat 23 May 2026 12:41"},
  "66":{"start":"Clevedon","end":"Portishead","setoff":"Sat 23 May 2026 12:41","finish":"Sat 23 May 2026 15:48"},
  "67":{"start":"Portishead","end":"Bristol","setoff":"Sat 23 May 2026 15:48","finish":"Sat 23 May 2026 19:42"},
  "68":{"start":"Bristol","end":"Finish","setoff":"Sat 23 May 2026 19:42","finish":"Sat 23 May 2026 20:00"}
};

function createLegSelect(){
  const wrap = document.createElement('div');
  wrap.style.marginBottom = '10px';

  const sel = document.createElement('select');
  sel.required = true;
  sel.innerHTML = '<option value="">Select a leg…</option>';

  for (let i=1; i<=TOTAL_LEGS; i++){
    const info = LEG_INFO[String(i)];
    const opt = document.createElement('option');
    opt.value = String(i);

    if (info) {
      opt.textContent = `${i}: ${info.start} → ${info.end} (${info.setoff} to ${info.finish})`;
    } else {
      opt.textContent = `Leg ${i}`;
    }

    sel.appendChild(opt);
  }

  wrap.appendChild(sel);
  return { wrap, sel };
}

const legSelects = [];

function addLeg(){
  const { wrap, sel } = createLegSelect();
  legsContainer.appendChild(wrap);
  legSelects.push(sel);

  // Apply availability labels and keep notice updated
  applyAvailabilityToSelect(sel);
  sel.addEventListener('change', refreshTakenNotice);
  refreshTakenNotice();
}

(async () => {
  await loadTakenLegs();
  addLeg();
  refreshTakenNotice();
})();

addLegBtn.addEventListener('click', () => {
  addLeg();
});

/* modals */
const safetyModal = document.getElementById('safetyModal');
const successModal = document.getElementById('successModal');
document.getElementById('openSafety').addEventListener('click', () => { safetyModal.style.display='flex'; });
document.getElementById('closeSafety').addEventListener('click', () => { safetyModal.style.display='none'; });

const groupInfoModal = document.getElementById('groupInfoModal');
document.getElementById('openGroupInfo').addEventListener('click', () => { groupInfoModal.style.display='flex'; });
document.getElementById('closeGroupInfo').addEventListener('click', () => { groupInfoModal.style.display='none'; });

document.getElementById('closeSuccess').addEventListener('click', () => {
  successModal.style.display='none';
  window.location.href = 'signup-status.html';
});

/* submit */
form.addEventListener('submit', async (e) => {
  e.preventDefault();

  if (!safetyAccepted.checked) {
    safetyModal.style.display = 'flex';
    return;
  }

  const legs = legSelects.map(s => s.value).filter(Boolean);

  const payload = {
    team_leader_first_name: teamLeaderFirstName.value.trim(),
    team_leader_surname: teamLeaderSurname.value.trim(),
    group_size: groupSize.value,
    email: email.value.trim(),
    phone: phone.value.trim(),
    safety_accepted: safetyAccepted.checked ? 1 : 0,
    legs: legs
  };

  try {
    const res = await fetch('submit_signup.php', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    const data = await res.json();

    if (data && data.success) {
      successModal.style.display = 'flex';
      return;
    }

    alert((data && data.error) ? data.error : 'Error submitting form');
  } catch (err) {
    alert('Error submitting form');
  }
});

// menu
const menuBtn = document.getElementById('menuBtn');
const menu = document.getElementById('site-menu');
menuBtn.addEventListener('click', () => {
  menu.classList.toggle('open');
});
document.addEventListener('click', (e) => {
  if (!menu.contains(e.target) && !menuBtn.contains(e.target)) {
    menu.classList.remove('open');
  }
});
</script>

</body>
</html>
