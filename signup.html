<!doctype html>
<html lang="en-GB">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BE MORE AMY — Sign Up</title>
<link rel="stylesheet" href="style.css">

<style>
/* FIX: keep inputs/selects inside their container on mobile */
*, *::before, *::after { box-sizing: border-box; }

.signup-wrap { margin-top: 10px; border:2px solid #000; border-radius:18px; background:#fff; padding:16px; overflow:hidden; }
.form-grid { display:grid; gap:14px; min-width:0; }
.field label { display:block; font-weight:700; margin-bottom:6px; }
.field { min-width:0; }
.field input, .field select {
  width:100%;
  max-width:100%;
  display:block;
  min-width:0;
  padding:12px;
  border:2px solid #000;
  border-radius:14px;
  font-size:16px;
  box-sizing: border-box; /* extra safety */
}

.legs-block { border:2px solid rgba(0,0,0,0.12); border-radius:16px; padding:12px; }
.legs-title { font-weight:800; margin-bottom:10px; }

.btn {
  width:100%;
  max-width:100%;
  padding:14px;
  border-radius:16px;
  border:2px solid #000;
  background:#FAEBC8;
  color:#111;
  font-weight:800;
  font-size:16px;
  cursor:pointer;
  box-sizing: border-box;
}

.modal-backdrop {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  padding:20px;
  z-index: 9999;
}
.modal {
  background:#fff;
  border:2px solid #000;
  border-radius:18px;
  padding:16px;
  max-width:600px;
  width:100%;
  box-sizing: border-box;
}
.modal button {
  margin-top:10px;
  padding:10px 14px;
  border-radius:14px;
  border:2px solid #000;
  background:#FAEBC8;
  color:#111;
  font-weight:800;
  width:100%;
  max-width:100%;
  box-sizing: border-box;
}

.linkish { text-decoration:underline; font-weight:800; cursor:pointer; }
</style>
</head>

<body>

<header class="site-header">
  <div class="header-inner">
    <div class="menu-wrap">
      <button class="menu-button" id="menuBtn">
        <img src="menu.svg" width="22" height="22" alt="Menu">
      </button>
      <nav class="menu-dropdown" id="site-menu">
        <a href="index.html">The Challenge</a>
        <a href="amy.html">About Amy</a>
        <a href="route.html">The Route</a>
        <a href="signup.html">Sign Up</a>
        
        <a href="signup-status.html">Signup Status</a>
<a href="charities.html">Charities</a>
        <a href="gallery.html">Gallery</a>
        <a href="contact.html">Contact</a>
      </nav>
    </div>

    <div class="brand">
      <a href="index.html">
        <img class="brand-logo" src="BMAlogo.svg" width="100" alt="Be More Amy">
      </a>
      <div class="brand-text">
        <div class="brand-line brand-title">BE MORE AMY</div>
        <div class="brand-line brand-subtitle">South West Coastal</div>
        <div class="brand-line brand-subtitle">Path Relay Challenge</div>
        <div class="brand-line brand-date">16th to 23rd May 2026</div>
      </div>
    </div>
  </div>
</header>

<main class="page">
<h1>Sign Up</h1>

<div class="signup-wrap">
<form id="signupForm" class="form-grid" novalidate>

  <div class="field">
    <label for="teamLeaderFirstName">Team Leader First Name</label>
    <input id="teamLeaderFirstName" required>
  </div>

  <div class="field">
    <label for="teamLeaderSurname">Team Leader Surname</label>
    <input id="teamLeaderSurname" required>
  </div>

  <div class="field">
    <label for="groupSize">
      Number of people in your group
      <span class="linkish" id="openGroupInfo" aria-label="More information">ⓘ</span>
    </label>
    <input id="groupSize" type="number" inputmode="numeric" min="1" max="100" required>
  </div>

  <div class="field">
    <label for="email">E-mail</label>
    <input id="email" type="email" required>
  </div>

  <div class="field">
    <label for="phone">Phone Number</label>
    <input id="phone" required>
  </div>

  <div class="legs-block">
    <div class="legs-title">Choose your legs</div>
    <div id="legsContainer"></div>
    <div id="takenNotice" style="margin:10px 0 10px; font-weight:700;"></div>
    <button type="button" id="addLegBtn" class="btn">Add Another Leg</button>
  </div>

  <div>
    <input type="checkbox" id="safetyAccepted">
    <label for="safetyAccepted">
      I confirm I have read and agree to the
      <span class="linkish" id="openSafety">safety information</span>.
    </label>
  </div>

  <button type="submit" class="btn" id="submitBtn">Submit</button>

</form>
</div>
</main>

<!-- Safety modal -->
<div class="modal-backdrop" id="safetyModal">
  <div class="modal">
    <h2>Safety Information</h2>
    <p>
      This is a self-led relay challenge. By signing up, you confirm that you and any team members are responsible
      for your own safety, planning, navigation, equipment, fitness to take part, and wellbeing throughout your leg(s).
      You should take appropriate precautions for coastal path conditions, weather, tides, and terrain, and you are
      responsible for following relevant laws and guidance, including road safety where applicable.
    </p>
    <p>
      The organisers and associated volunteers do not provide supervision, medical cover, or safety support on the route.
      Participation is voluntary and undertaken at your own risk.
    </p>
    <p>
      Nothing in this notice excludes or limits liability where it would be unlawful to do so.
    </p>
    <button type="button" id="closeSafety">Close</button>
  </div>
</div>


<!-- Group size info modal -->
<div class="modal-backdrop" id="groupInfoModal">
  <div class="modal">
    <h2>Group Information</h2>
    <p>Names, contact details and emergency contact details for all members of the group will be collected later.</p>
    <button type="button" id="closeGroupInfo">Close</button>
  </div>
</div>


<!-- Success modal -->
<div class="modal-backdrop" id="successModal">
  <div class="modal">
    <h2>Thank You</h2>
    <p>Your signup has been received and is now pending approval.</p>
    <p>Click continue to view the current signups.</p>
    <button type="button" id="closeSuccess">Continue</button>
  </div>
</div>

<script>
const form = document.getElementById('signupForm');
const legsContainer = document.getElementById('legsContainer');
const addLegBtn = document.getElementById('addLegBtn');

const teamLeaderFirstName = document.getElementById('teamLeaderFirstName');
const teamLeaderSurname = document.getElementById('teamLeaderSurname');
const email = document.getElementById('email');
const groupSize = document.getElementById('groupSize');
const phone = document.getElementById('phone');
const safetyAccepted = document.getElementById('safetyAccepted');

const TOTAL_LEGS = 68;

let TAKEN_LEGS = new Set();

async function loadTakenLegs() {
  try {
    const res = await fetch('get_taken_legs.php');
    const data = await res.json();
    if (data && data.success && Array.isArray(data.taken_legs)) {
      TAKEN_LEGS = new Set(data.taken_legs.map(n => String(n)));
    } else {
      TAKEN_LEGS = new Set();
    }
  } catch (e) {
    TAKEN_LEGS = new Set();
  }
}

function applyAvailabilityToSelect(selectEl) {
  Array.from(selectEl.options).forEach(opt => {
    if (!opt.value) return;
    if (!opt.dataset.baseText) opt.dataset.baseText = opt.textContent;
    const taken = TAKEN_LEGS.has(String(opt.value));
    opt.textContent = opt.dataset.baseText + (taken ? ' - Taken' : ' - Available');
  });
}

function refreshTakenNotice() {
  const notice = document.getElementById('takenNotice');
  const selected = legSelects.map(s => s.value).filter(Boolean);
  const takenSelected = selected.filter(v => TAKEN_LEGS.has(String(v)));

  if (!notice) return;

  if (takenSelected.length === 0) {
    notice.textContent = '';
    return;
  }

  const uniq = Array.from(new Set(takenSelected.map(v => String(v)))).sort((a,b)=>parseInt(a)-parseInt(b));
  notice.textContent = `Leg${uniq.length > 1 ? 's' : ''} ${uniq.join(', ')} ${uniq.length > 1 ? 'are' : 'is'} already taken. If you proceed with this selection, your interest will be noted should it become available.`;
}


// Only used to generate the dropdown labels
const LEG_INFO = {
  "1":{"start":"Studland","end":"Durlston Head","setoff":"Sat 16 May 2026 08:00","finish":"Sat 16 May 2026 10:27"},
  "2":{"start":"Durlston Head","end":"Kimmeridge","setoff":"Sat 16 May 2026 10:27","finish":"Sat 16 May 2026 13:44"},
  "3":{"start":"Kimmeridge","end":"Durdle Door","setoff":"Sat 16 May 2026 13:44","finish":"Sat 16 May 2026 16:22"},
  "4":{"start":"Durdle Door","end":"Bowleaze Cove","setoff":"Sat 16 May 2026 16:22","finish":"Sat 16 May 2026 18:33"},
  "5":{"start":"Bowleaze Cove","end":"Chesil Beach","setoff":"Sat 16 May 2026 18:33","finish":"Sat 16 May 2026 20:01"},
  "6":{"start":"Chesil Beach","end":"Portland Bill","setoff":"Sat 16 May 2026 20:01","finish":"Sat 16 May 2026 21:51"},
  "7":{"start":"Portland Bill","end":"Wyke Regis","setoff":"Sat 16 May 2026 21:51","finish":"Sat 16 May 2026 23:41"},
  "8":{"start":"Wyke Regis","end":"Abbotsbury","setoff":"Sat 16 May 2026 23:41","finish":"Sun 17 May 2026 02:14"},
  "9":{"start":"Abbotsbury","end":"West Bay","setoff":"Sun 17 May 2026 02:14","finish":"Sun 17 May 2026 04:48"},
  "10":{"start":"West Bay","end":"Seatown","setoff":"Sun 17 May 2026 04:48","finish":"Sun 17 May 2026 07:00"},
  "11":{"start":"Seatown","end":"Lyme Regis","setoff":"Sun 17 May 2026 07:00","finish":"Sun 17 May 2026 09:19"},
  "12":{"start":"Lyme Regis","end":"Seaton","setoff":"Sun 17 May 2026 09:19","finish":"Sun 17 May 2026 11:53"},
  "13":{"start":"Seaton","end":"Budleigh Salterton","setoff":"Sun 17 May 2026 11:53","finish":"Sun 17 May 2026 15:03"},
  "14":{"start":"Budleigh Salterton","end":"Exmouth","setoff":"Sun 17 May 2026 15:03","finish":"Sun 17 May 2026 16:45"},
  "15":{"start":"Exmouth","end":"Dawlish","setoff":"Sun 17 May 2026 16:45","finish":"Sun 17 May 2026 19:26"},
  "16":{"start":"Dawlish","end":"Teignmouth","setoff":"Sun 17 May 2026 19:26","finish":"Sun 17 May 2026 21:31"},
  "17":{"start":"Teignmouth","end":"Torquay","setoff":"Sun 17 May 2026 21:31","finish":"Sun 17 May 2026 23:06"},
  "18":{"start":"Torquay","end":"Brixham","setoff":"Sun 17 May 2026 23:06","finish":"Mon 18 May 2026 01:39"},
  "19":{"start":"Brixham","end":"Berry Head","setoff":"Mon 18 May 2026 01:39","finish":"Mon 18 May 2026 04:35"},
  "20":{"start":"Berry Head","end":"Dartmouth","setoff":"Mon 18 May 2026 04:35","finish":"Mon 18 May 2026 07:42"},
  "21":{"start":"Dartmouth","end":"Slapton Sands","setoff":"Mon 18 May 2026 07:42","finish":"Mon 18 May 2026 10:48"},
  "22":{"start":"Slapton Sands","end":"Kingsbridge","setoff":"Mon 18 May 2026 10:48","finish":"Mon 18 May 2026 12:31"},
  "23":{"start":"Kingsbridge","end":"Hope Cove","setoff":"Mon 18 May 2026 12:31","finish":"Mon 18 May 2026 14:50"},
  "24":{"start":"Hope Cove","end":"Bantham","setoff":"Mon 18 May 2026 14:50","finish":"Mon 18 May 2026 17:45"},
  "25":{"start":"Bantham","end":"Bigbury-on-Sea","setoff":"Mon 18 May 2026 17:45","finish":"Mon 18 May 2026 19:02"},
  "26":{"start":"Bigbury-on-Sea","end":"Wembury","setoff":"Mon 18 May 2026 19:02","finish":"Mon 18 May 2026 21:47"},
  "27":{"start":"Wembury","end":"Plymouth","setoff":"Mon 18 May 2026 21:47","finish":"Tue 19 May 2026 00:35"},
  "28":{"start":"Plymouth","end":"Bovisand","setoff":"Tue 19 May 2026 00:35","finish":"Tue 19 May 2026 04:15"},
  "29":{"start":"Bovisand","end":"Rame Head","setoff":"Tue 19 May 2026 04:15","finish":"Tue 19 May 2026 06:37"},
  "30":{"start":"Rame Head","end":"Kingsand","setoff":"Tue 19 May 2026 06:37","finish":"Tue 19 May 2026 09:13"},
  "31":{"start":"Kingsand","end":"Looe","setoff":"Tue 19 May 2026 09:13","finish":"Tue 19 May 2026 12:41"},
  "32":{"start":"Looe","end":"Polperro","setoff":"Tue 19 May 2026 12:41","finish":"Tue 19 May 2026 14:53"},
  "33":{"start":"Polperro","end":"Fowey","setoff":"Tue 19 May 2026 14:53","finish":"Tue 19 May 2026 16:28"},
  "34":{"start":"Fowey","end":"Charlestown","setoff":"Tue 19 May 2026 16:28","finish":"Tue 19 May 2026 19:02"},
  "35":{"start":"Charlestown","end":"Mevagissey","setoff":"Tue 19 May 2026 19:02","finish":"Tue 19 May 2026 21:28"},
  "36":{"start":"Mevagissey","end":"Gorran Haven","setoff":"Tue 19 May 2026 21:28","finish":"Wed 20 May 2026 00:24"},
  "37":{"start":"Gorran Haven","end":"Caerhays","setoff":"Wed 20 May 2026 00:24","finish":"Wed 20 May 2026 03:12"},
  "38":{"start":"Caerhays","end":"Portscatho","setoff":"Wed 20 May 2026 03:12","finish":"Wed 20 May 2026 06:15"},
  "39":{"start":"Portscatho","end":"St Mawes","setoff":"Wed 20 May 2026 06:15","finish":"Wed 20 May 2026 08:56"},
  "40":{"start":"St Mawes","end":"Falmouth","setoff":"Wed 20 May 2026 08:56","finish":"Wed 20 May 2026 11:51"},
  "41":{"start":"Falmouth","end":"Maenporth","setoff":"Wed 20 May 2026 11:51","finish":"Wed 20 May 2026 14:25"},
  "42":{"start":"Maenporth","end":"Porthleven","setoff":"Wed 20 May 2026 14:25","finish":"Wed 20 May 2026 16:51"},
  "43":{"start":"Porthleven","end":"Marazion","setoff":"Wed 20 May 2026 16:51","finish":"Wed 20 May 2026 20:31"},
  "44":{"start":"Marazion","end":"Penzance","setoff":"Wed 20 May 2026 20:31","finish":"Wed 20 May 2026 22:57"},
  "45":{"start":"Penzance","end":"Sennen Cove","setoff":"Wed 20 May 2026 22:57","finish":"Thu 21 May 2026 01:31"},
  "46":{"start":"Sennen Cove","end":"St Just","setoff":"Thu 21 May 2026 01:31","finish":"Thu 21 May 2026 04:05"},
  "47":{"start":"St Just","end":"Pendeen","setoff":"Thu 21 May 2026 04:05","finish":"Thu 21 May 2026 07:00"},
  "48":{"start":"Pendeen","end":"St Ives","setoff":"Thu 21 May 2026 07:00","finish":"Thu 21 May 2026 09:34"},
  "49":{"start":"St Ives","end":"Portreath","setoff":"Thu 21 May 2026 09:34","finish":"Thu 21 May 2026 12:30"},
  "50":{"start":"Portreath","end":"Porthtowan","setoff":"Thu 21 May 2026 12:30","finish":"Thu 21 May 2026 14:56"},
  "51":{"start":"Porthtowan","end":"Perranporth","setoff":"Thu 21 May 2026 14:56","finish":"Thu 21 May 2026 17:19"},
  "52":{"start":"Perranporth","end":"Newquay","setoff":"Thu 21 May 2026 17:19","finish":"Thu 21 May 2026 20:36"},
  "53":{"start":"Newquay","end":"Padstow","setoff":"Thu 21 May 2026 20:36","finish":"Thu 21 May 2026 22:33"},
  "54":{"start":"Padstow","end":"Port Isaac","setoff":"Thu 21 May 2026 22:33","finish":"Fri 22 May 2026 00:52"},
  "55":{"start":"Port Isaac","end":"Tintagel","setoff":"Fri 22 May 2026 00:52","finish":"Fri 22 May 2026 03:55"},
  "56":{"start":"Tintagel","end":"Boscastle","setoff":"Fri 22 May 2026 03:55","finish":"Fri 22 May 2026 07:13"},
  "57":{"start":"Boscastle","end":"Bude","setoff":"Fri 22 May 2026 07:13","finish":"Fri 22 May 2026 09:39"},
  "58":{"start":"Bude","end":"Westward Ho!","setoff":"Fri 22 May 2026 09:39","finish":"Fri 22 May 2026 12:57"},
  "59":{"start":"Westward Ho!","end":"Clovelly","setoff":"Fri 22 May 2026 12:57","finish":"Fri 22 May 2026 15:38"},
  "60":{"start":"Clovelly","end":"Hartland Quay","setoff":"Fri 22 May 2026 15:38","finish":"Fri 22 May 2026 17:49"},
  "61":{"start":"Hartland Quay","end":"Bucks Mills","setoff":"Fri 22 May 2026 17:49","finish":"Fri 22 May 2026 20:08"},
  "62":{"start":"Bucks Mills","end":"Westward Ho!","setoff":"Fri 22 May 2026 20:08","finish":"Fri 22 May 2026 22:35"},
  "63":{"start":"Westward Ho!","end":"Appledore","setoff":"Fri 22 May 2026 22:35","finish":"Sat 23 May 2026 01:16"},
  "64":{"start":"Appledore","end":"Instow","setoff":"Sat 23 May 2026 01:16","finish":"Sat 23 May 2026 04:19"},
  "65":{"start":"Instow","end":"Croyde","setoff":"Sat 23 May 2026 04:19","finish":"Sat 23 May 2026 07:36"},
  "66":{"start":"Croyde","end":"Woolacombe","setoff":"Sat 23 May 2026 07:36","finish":"Sat 23 May 2026 10:10"},
  "67":{"start":"Woolacombe","end":"Ilfracombe","setoff":"Sat 23 May 2026 10:10","finish":"Sat 23 May 2026 12:11"},
  "68":{"start":"Ilfracombe","end":"Combe Martin","setoff":"Sat 23 May 2026 12:11","finish":"Sat 23 May 2026 14:00"}
};

function fmtShort(str){
  const s = String(str || "");
  const m = s.match(/^([A-Za-z]{3})\s+(\d{1,2})\s+([A-Za-z]{3})\s+\d{4}\s+(\d{2}):(\d{2})$/);
  if (!m) return s;
  return `${m[4]}${m[5]} ${m[1]} ${m[2]} ${m[3]}`;
}

function makeLegLabel(n){
  const info = LEG_INFO[String(n)];
  if (!info) return `Leg ${n}`;
  const setoff = fmtShort(info.setoff);
  const finish = fmtShort(info.finish);
  return `Leg ${n}: ${info.start} to ${info.end} (${setoff} - ${finish})`;
}

function createLegSelect(){
  const wrap = document.createElement('div');
  wrap.className = 'field';

  const sel = document.createElement('select');
  sel.required = true;

  const placeholder = document.createElement('option');
  placeholder.value = '';
  placeholder.textContent = 'Select a leg';
  placeholder.selected = true;
  placeholder.disabled = true;
  sel.appendChild(placeholder);

  for (let i=1;i<=TOTAL_LEGS;i++){
    const opt = document.createElement('option');
    opt.value = String(i);
    opt.textContent = makeLegLabel(i);
    sel.appendChild(opt);
  }

  wrap.appendChild(sel);
  return { wrap, sel };
}

const legSelects = [];

function addLeg(){
  const { wrap, sel } = createLegSelect();
  legsContainer.appendChild(wrap);
  legSelects.push(sel);

  // Apply availability labels and keep notice updated
  applyAvailabilityToSelect(sel);
  sel.addEventListener('change', refreshTakenNotice);
  refreshTakenNotice();
}

(async () => {
  await loadTakenLegs();
  addLeg();
  refreshTakenNotice();
})();

addLegBtn.addEventListener('click', () => {
  addLeg();
});

/* modals */
const safetyModal = document.getElementById('safetyModal');
const successModal = document.getElementById('successModal');
document.getElementById('openSafety').addEventListener('click', () => { safetyModal.style.display='flex'; });
document.getElementById('closeSafety').addEventListener('click', () => { safetyModal.style.display='none'; });

const groupInfoModal = document.getElementById('groupInfoModal');
document.getElementById('openGroupInfo').addEventListener('click', () => { groupInfoModal.style.display='flex'; });
document.getElementById('closeGroupInfo').addEventListener('click', () => { groupInfoModal.style.display='none'; });

document.getElementById('closeSuccess').addEventListener('click', () => {
  successModal.style.display='none';
  window.location.href = 'signup-status.html';
});

/* submit */
form.addEventListener('submit', async (e) => {
  e.preventDefault();

  if (!safetyAccepted.checked) {
    safetyModal.style.display = 'flex';
    return;
  }

  const legs = legSelects.map(s => s.value).filter(Boolean);

  const payload = {
    team_leader_first_name: teamLeaderFirstName.value.trim(),
    team_leader_surname: teamLeaderSurname.value.trim(),
    group_size: groupSize.value,
    email: email.value.trim(),
    phone: phone.value.trim(),
    safety_accepted: safetyAccepted.checked ? 1 : 0,
    legs: legs
  };

  try {
    const res = await fetch('submit_signup.php', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    const data = await res.json();

    if (data && data.success) {
      successModal.style.display = 'flex';
      form.reset();
      legsContainer.innerHTML = '';
      legSelects.length = 0;
      addLeg();
    } else {
      alert((data && data.error) ? data.error : 'There was a problem submitting your signup.');
    }
  } catch (err) {
    alert('There was a problem submitting your signup.');
  }
});

/* menu toggle */
const menuBtn = document.getElementById("menuBtn");
const menu = document.getElementById("site-menu");

menuBtn.addEventListener("click", () => {
  menu.classList.toggle("open");
});

document.addEventListener("click", (e) => {
  if (!menu.contains(e.target) && !menuBtn.contains(e.target)) {
    menu.classList.remove("open");
  }
});
</script>

</body>
</html>
